제 7 장 텍스트 편집 02	

	7.3 파일 찾기와 문자열 검색
 

<locate, find, grep>

리눅스 시스템을 사용하면서 사용자가 원하는 파일이 디렉터리 트리에서 어디에 위치하는  찾아야 할 때가 있다. 

00. locate	: 이때 파일 이름의 일부라도 알고 있다면 locate 명령을 사용할 수 있다. 
01. find	: 또한 파일의 속성(이름, 크기, 수정시간, 소유자 등)을 기준으로 찾으려면 find 명령을 사용할 수 있다. 
02. grep	: 만약 텍스트 파일 안에 존재하는 특정 문자열을 찾아 편집해야 할 때는 grep 명령을 사용하면 효율적으로 작업할 수 있다.


	1. 이름으로 파일 찾기: locate

01. 
대부분의 리눅스 시스템은 하루에 한 번 리눅스 시스템에 파일의 이름을 수집하여 데이터베이스에 저장한다. 이것을 수행하는 명령은 updatedb이며, 하루 간격으로 수행되는 /etc/cron.daily/mlocate.cron 스크립트 파일에서 확인할 수 있다.

02. 
locate 명령은 updatedb 명령에서 만들어진 데이터베이스를 검색하여 파일의 위치를 찾아주는 명령이며 그 사용법은 다음과 같다.

	locate [options] pattern

03. 
locate 명령은 데이터베이스에 존재하는 파일(또는 디렉터리)의 이름이(기본적으로 /로 시작하는 경로 이름) 주어진 문자열 패턴(pattern)을 포함한다면 해당 파일(또는 디렉터리)의 이름을 출력한다.

04.
locate 명령의 좋은 점은 전체 파일 시스템을 검색하지 않고, 데이터베이스를 검색하기 때문에 빠르다는 것이다. 물론 updatedb의 설정 파일인 /etc/updatedb.conf의 설정에 의해 데이터베이스에 저장하지 않는 파일은 검색할 수 없다.

05.
일반 사용자가 파일 시스템에서 접근할 수 없는 파일이 있다면 해당 데이터베이스에서도 검색할 수 없다. 

06.
.bashrc를 포함하는 파일을 찾을 때 일반 사용자는 자신의 홈 디렉터리와 /etc/skel/ 디렉터리에 있는 .bashrc 파일만 찾을 수 있다.

07.
find 명령으로는 파일(또는 디렉터리)의 이름을 검색할 때 -name 옵션을 사용하는데, 이때는 파일이나 디렉터리의 이름이 정확히 일치하는 경우만 검색한다. 반면에, locate 명령은 주어진 파일이나 디렉터리의 경로상에서 주어진 문자열을 포핮하기만 하면 된다. 


	2. 조건으로 찾기: find

00.
파일 시스템에서 파일을 검색하는 가장 좋은 방법은 find 명령을 사용하는 것이다. 단순히 이름만 가지고 찾는 것이 아니라 파일이 가진 속성을 기준으로 파일을 찾고, 계속해서 검색된 파일을 대상으로 적당한 명령을 수행할 수 있기 때문이다. 파일을 검색할 때 검색 위치를 지정할 수 있으며, 이름, 소유자, 접근권한, 크기, 수정시간 등의 파일 속성을 조건으로 사용할 수 있다. 사용법은 다음과 같다.

	find [pathnames] [expression]

01.
경로를 지정하지 않으면 현재 디렉터리를 의미하는 점(.)이 기본으로 주어지며, 조건이나 액션(expression)이 주어지지 않으면 -print가 주어진다. 그래서 단순히 find만 입력하여 실행하면 현재 디렉터리에 존재하는 모든 파일(또는 디렉터리)을 라인 단위로 화면에 보여 준다.

02. 
특별히 지정된 것이 없다면, find 명령은 지정 디렉터리는 물론 서브디렉터리도 모두 검색하여 조건에 맞는 파일을 찾는다. 당연히 실행 권한이 있는 파일만 검색할 수 있다.

	find /etc -name passwd	명령은 지정된 위치에서 파일의 이름으 정확하게 passwd인 파일을 찾아 라인 단위로 출력한다.
	find /etc -iname *passwd*	명령은 지정된 위치에서 이름에 passwd 가 포함된 파일을 찾는다. -iname	옵션은 대소문자를 구분하지 않는다.
	
	find /etc -name passwd 2> /dev/null
	find /etc -iname '*passwd*' 2> /dev/null

03. 
find 명령의 결과가 파일의 이름을 화면에 라인 단위로 출력하는 것이므로 파이프(|) 기능을 이용하면 find 명령과 다른 프로그램을 연결시켜 유용하게 사용할 수 있다.

	find ~ | wc -1		사용자의 홈 디렉터리(~)에 존재하는 파일의 총개수를 세어 출력한다.

04.
find 명령의 기능은 매우 강력하다. 그 이유는 파일을 찾을 때 다양하고 특별한 조건 지정하고, 그것을 만족하는 파일(또는 디렉터리)을 선택할 수 있기 때문이다. 

	find . type d | wc -l   --> 현재 디렉터리(.)의 디렉터리 개수를 출력
	find . type f | wc -l   --> 현재 디렉터리(.)의 정규 파일(f, 링크나 디렉터리가 아닌 파일)의 개수를 출력
05. 
find 명령에 사용할 수 있는 조건 의미와 지정방법은 다음과 같다.
  
  1) find -cmin n	: 파일(또는 디렉터리)의 내용이나 속성의 마지막 수정시간이 정확히 n분인 경우이다. 
			  n분보다 작음을 의미하려면 -n, 보다 큼을 의미하려면 +n을 사용한다.
  2) find -cnewer file	: 파일(또는 디렉터리)의 내용이나 속성의 마지막 수정시간이 지정된 file보다 최근의 것임을 의미한다.
  3) find -ctime n	: 파일(또는 디렉터리)의 내용이나 속성의 마지막 수정시간이 n*24시간 이전인 경우를 의미한다.
  4) find -mmin n	: 파일(또는 디렉터리)의 내용이 n분 이전에 수정된 경우이다.   

  5) find -empty	: 파일(또는 디렉터리)이 비어 있는 경우를 의미한다.
  6) find -group name	: 파일(또는 디렉터리)의 속한 그룹이 name인 경우이다. name은 이름이나 GID로 표시할 수 있다.

  7) find -iname pattern: find -name과 같으나 대소문자를 구분하지 않는다.
  8) find -inum n	: inode 번호를 가진 파일이다. 하드 링크를 찾을 때 사용한다.

  9) find -name pattern	: 파일(또는 디렉터리)의 이름이 pattern과 매칭되는 경우이다.
 10) find -newer file	: 파일(또는 디렉터리)의 내용이 지정된 파일보다 최근에 수정된 경우이다. 이것을 사용하면 파일 시스템을 백업할 때 지난 백업 이후의 수정된 것만 선택하여 백업할 수 있다.
 11) find -nouser	: 사용자 계정이 삭제되었거나 해커의 공격이 있었을 경우처럼, 파일(또는 디렉터리)이 유효한 사용자에 속해 있지 않은 경우이다. 
 12) find -nogroup	: 파일(또는 디렉터리)이 유효한 그룹에 속해 있지 않은 경우이다. 
 13) find -perm mode	: 파일(또는 디렉터리)의 접근권한이 mode와 같은 경우이다. 

 14) find -size n	: 파일(또는 디렉터리)의 크기가 n인 경우이다. 단위로는 b(512바이트 블록), c(바이트), k(킬로바이트), M(메가바이트), G(기가바이트)가 있다. 
 15) find -type c	: 파일의 타입이 c인 경우이다. 파일 타입으로는 b(블럭디바이스), c(문자디바이스), d(디렉터리), f(정규 파일), l(심벌릭 링크)가 있다.
 16) find -user name	: 파일(또는 디렉터리)의 소유자가 name인 경우이다. name은 계정 이름 또는 UID로 표시할 수 있다.

06.
여러 개의 조건을 합성하여 사용활 수도 있는데, 이때 논리 연산자가 필요하다. 또한 괄호도 사용할 수 있다.

  1) -and	: and의 의미이며 간단하게 a로 쓸 수 있다. 조건 사이에 논리 연산자가 주어지지 않았다면 -and가 기본값이다.
  2) -or	: or의 의미이며 간단히 -o로 쓸 수 있다.
  3) -not	: not의 의미이며 간단히 -!로 쓸 수 있다
  4) ()		: 논리연산자의 우선순위를 바꾸거나 가독성을 높이기 위해 사용된다. 
		  괄호가 셸 명령에서 사용될 때는 백슬래시(\)를 사용하여 이스케이프 시켜야 한다.

07.
find 명령이 특별히 유용하게 사용되는 이유는 조건에 맞는 파일을 검색하고, 검색 결과에 나타난 각 파일에 대해 특별한 액션을 사용할 수 있기 때문이다. 이때 이미 정의된 액션을 사용할 수 있고, 사용자 정의 액션을 사용할 수 있으며, 사용자 정의 액션을 적용할 수도 있다.

  1) -delete	: 파일을 삭제한다.	-exec rm {} /;	명령과 동일하다.
  2) -ls	: 파일(또는 디렉터리)의 정보를 자세히 보여준다. 이때 각각에 대해 ls -dils를 실행하여 화면에 출력한다.
  3) -print	: 경로를 포함하여 파일 이름을 화면에 출력한다. 다른 액션이 없다면 기본값이다.
  4) -quit	: 매칭되는 것이 있다면 종료한다.
  5) -exec command {} \;	: 사용자 정의 액션으로 임의의 command를 수행할 수 있다. {}는 find가 찾은 파일 이름이 들어가는 자리이다.
  6) -ok command {} \;	: 사용자 정의 액션으로 임의의 command를 수행할 수 있다. 확인과정을 거친다.

	find /home -name "*.log" -exec rm {} \;
	find . type f -name "*.txt" -exec cat {} \;
	find /etc -type f -name "*.conf" ls -l {} \;
  	find /home -name "*.log" -ok rm {} \;

	🧩 find -exec 액션 실전 예시 목록

	번호	명령어 예시				설명

	①	find . -type f -name "*.bak" -exec rm {} \;	.bak 백업 파일을 모두 삭제
	②	find /var/log -type f -name "*.log" -mtime +30 -exec rm {} \;	30일 이상 지난 .log 파일 삭제
	③	find . -type f -name "*.sh" -exec ls -l {} \;	.sh 스크립트 파일의 상세 정보 출력
	④	find . -type f -name "*.c" -exec grep -H "main" {} \;	C 소스 파일에서 "main" 문자열 검색
	⑤	find . -type f -name "*.jpg" -exec cp {} /backup/images/ \;	.jpg 파일을 /backup/images/ 폴더로 복사
	⑥	find ~/scripts -type f -name "*.sh" -exec chmod +x {} \;	스크립트 파일에 실행권한(+x) 추가
	⑦	find . -type f -size +10M -exec ls -lh {} \;	10MB 이상인 파일들의 상세 정보 출력
	⑧	find . -name "*.txt" -exec tar -rvf texts.tar {} +	.txt 파일들을 texts.tar에 묶음
	⑨	find /home -user guest -exec mv {} /home/guest_backup/ \;	guest 사용자의 파일을 백업 폴더로 이동
	⑩	find . -name "*.tmp" -ok rm {} \;	.tmp 파일을 삭제하기 전에 확인(y/n) 요청

08.
사용자 정의 액션에서 {}는 상응하는 파일(또는 디렉터리)을 표시하는 기호이며, 세미콜론(;)은 명령의 종료를 표시하기 위한 구분자이다. -delete를 사용하지 않고 -exec 사용하여 삭제 기능을 수행하고 싶을 때는 -exec rm {};과 같이 작성하면 된다. 세미콜론(;)은 셸에서 특별한 의미를 가지므로 괄호()를 사용할 때와 마찬가지로 이스케이프 시키거나 따옴표로 묶어야 한다. 사용자 정의 액션을 사용할 때 확인과정이 필요하면 -exec 대신에 -ok를 사용한다.

09.
touch file 명령은 파일 또는 디렉터리의 수정시간을 현재 시간으로 바꾸는 명령이다. 만약 file이 존재하지 않으면 0바이트 크기의 새로운 파일을 만든다.

	touch memo{1,2,3,4,5}	memo1. ,memo2...memo5
	touch {a..c}{1..10}	a1, ...a10, b1.. b10, c1..c10

10. 기타 중요한 명령
(ls) ls 명령은 인자로 여러 디렉터리를 주면, 각 디렉터리 이름 뒤에 :을 붙이고 그 안의 내용도 조건에 상관없이  출력합니다. ls [abc]*로 검색하면, 해당 디렉터리의 a, b 또는 c로 시작하는 파일이나 디렉터리 뿐만 아니라, 이렇게 검색된 디렉터리에 속한 파일 정보도 조건에 상관없이 다 보여준다. 

(du) du 파일 명령은 디스크 사용량을 보여 주는 명령이다.
(su) su - 명령은 사용자를 root 사용자로 변경하는 명령이고, su - name은 사용자를 변경하는 명령이다. 

11. find 명령 사용 예
	
	find usr/share -size +10M	지정된 위치에서 10M보다 큰 크기의 파일을 찾아 화면에 출력 -print 기본 옵션으로 작동
	find /data -size +500M -size -5G -exec du ]'{}' \;	지정된 위치에서 500M보다 크고 5G 보다 작은 크기의 화일을 찾고 파일 각각에 대하여
								du 파일 명령(디스크사용량을 보여주는 명령)을 실행한다.
	find . -type f -exec file '{}' \;	지정된 위치에서 파일을 찾아 file 명령(매직넘바 목록을 보고 파일 종류를 알아냄)을 수행
	find /home -user chris -ls	지정 위치에서 소유자가 chris인 파일(또는 디렉터리)을 찾아 파일 정보를 자세히 보여 줌.
	find /home -user chris -or -group staff -ls	지정 위치에서 사용자가 chris이거나 소유그룹이 staff인 파일을 찾아 자세히 보여준다.
	
	find /bin -perm 755 -ls		접근권한이 rwxr-xr-x인 파일(또는디렉터리)를 찾아 자세 보여준다(-ls).
	find /home/chris/ -perm -444 -type d -ls	접근권한에서 '소유자, 그룹, 기타'의 읽기 권한이 두 설정된(즉, 모두가 읽을 수 있는) 디렉터리를 찾는다.
	
		2️⃣ -perm 뒤 숫자의 의미

		find의 -perm에는 접두 기호에 따라 해석 방식이 달라집니다.

		형식	의미	예시
		-perm 444	정확히 r--r--r-- 인 파일만	
		-perm -444	최소한 444(즉, 읽기 가능한) 권한을 가진 파일  *** +444 는 예전(findutils 4.4 이전) 의 “최소 권한 이상” 명령	
		-perm /444	소유자·그룹·기타 중 하나라도 읽기 가능한 파일

	find . perm -664	소유자와 그룹은 읽기와 쓰기 권한이 있고, 기타는 읽기 권한이 있는 파일이나 디렉터리를 ㄹ찾아 보여준다.

	find /etc/ -mmin -10	수정한 지 10분이 지나지 않은 파일을 찾는다..
	find /bin /usr/bin/ /sbin /usr/sbin -ctime -3	지정된 디렉터리에서 변경이 일어난 지 3일이 지나지 않은 파일을 찾는다.
	
	find ~ \( -type f -not -perm 0600 \) -or \( -type d -not -perm 0700 \)	홈 디렉터리(~)에서 접근권한이 600이 아닌 파일 또는 
										접근권한이 700이 아닌 디렉터리를 찾는다. 
	find ~ -type f -name '*.BAK' -print	홈 디렉터리(~)에서 이름이 .BAK로 끝나는 파일을 찾아 화면에 출력한다.
	find . -name '*.c' -print		현 디렉터리(.)에서 이름이 .c로 끝나는파일을 찾아 화면에 출력한다. = find . -name \*.c -print


3. 파일의 내용 검색하기: grep

00.
파일에서 패턴과 상응하는 특별한 단어나 문자열을 포함하는 라인을 찾아 출력할 때 grep 명령을 사용한다. 기본적으로 하나 또는 하나 이상의 파일을 대상으로 검색하며, 지정된 단어나 문자열을 포함하는 라인을 화면에 출력한다.

	grep [options] pattern [files]

여기서 pattern은 찾고자 하는 문자열을 표현하는 것인데, 정규식을 사용할 수 있다.

01.
-r 옵션을 사용하면 디렉터리를 지정하고, 그 디렉터리(서브디렉터리 포함)에 존재하는 모든 파일을 대상으로 검색할 수 있다. 이때 -l 옵션을 사용하여 문자열을 포하하는 파일의 이름만 출력할 수 있다. 자주 사용되는 옵션으로 대소문자를 구분하지 않는 -i 옵션과  반대의 경우를 출력하는, 즉 매칭이 일어나지 않는 모든 라인을 출력하는 -v 옵션도 있다.

	3️⃣ grep 명령의 옵션 하나씩 해석하기

	옵션	의미	예시

	-r	지정한 디렉터리 하위 폴더까지 재귀적으로(recursive) 검색	grep -r "main" ~/project
	-l	일치하는 파일 이름만 출력 (내용은 안 보여줌)	grep -rl "TODO" .
	-i	대소문자 무시 (case-insensitive)	grep -ri "error" /var/log
	-v	매칭되지 않는 라인만 출력 (반대 결과)	grep -v "PASS" result.txt	

02. 
다음 예는 /etc/passwd 파일에서 단어 root를 포함하는 라인을 출력한다. 

	grep root /etc/passwd

03. 
다음 예는 /etc 디렉터리에 있는 모든 파일(및 디렉터리)에서 단어 updatedb를 포함하는 라인을 출력한다.

	grep -r updatedb /etc

04. 
검색할 파일을 지정하는 대신 파이프(|)를 사용하면, 명령의 결과(원래 표준출력으로 나옴)를 grep 명령의 입력으로 받아들여 검색할 수 있다. 예를 들어 대량의 출력 결과가 화면에 표시될 때, grep 명령을 사용하여 특정 단어를 포함하는 라인만 골라 출력하게 하는 것이다. 즉 앞 명령의 결과가 표준출력으로 전달될 때 파이프(|) 기능을 사용하여 grep 명령과 연결시키고, 특정 문자열을 포함하는 라인만 출력하는 것이다. 다음은 네트워크 인터페이스 정보를 보여 주는 ip addr show 명령의 결과에서 문자열 inet을 포함하는 라인을 골라 출력한다.

	ip addr show | grep inet  

### 
UTF-8은 한글을 2바이트(EUC-KR)로 표현하지 않고 3바이트로 표현합니다. 그래서 vim은 “줄의 시작부터 커서까지 바이트 수”를 세면 3바이트씩 늘어나고, “화면상 열(column)”을 세면 2바이트씩 늘어나는 겁니다.
     
